O<ZMove_RepeatTZpe1> sub
#4 = [HAL_PIN_Z_MIN]
#5 = [HAL_PIN_Z_MAX]
#6 = [HAL_PIN_Z_INFEED]

IF [Z <= #4]
   #9 = [Z + #6]
   IF [#9 > #5]
      G1 Z[#5]
   ELSE
      G1 Z[#9]
   ENDIF
ELSE IF [Z >= #5]
   G1 Z[#4]
ENDIF
M99
O<ZMove_RepeatType1> endsub
