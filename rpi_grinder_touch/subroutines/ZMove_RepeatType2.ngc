O<ZMove_RepeatTZpe2> sub
#4 = [#<_hal[grinder.z_min]>] 
#5 = [#<_hal[grinder.z_max]>] 
#6 = [#<_hal[grinder.z_crossfeed]>] 
#7 = [#<_hal[grinder.z_speed]>]
#8 = [#<_hal[grinder.z_direction]>]

IF [#<_hal[grinder.enable_z]> EQ 1]

   IF [#8 EQ 1]
      M65 P0 (Set direction towards min, always go min. Though, this routine ignores this. It's just here for if the repeat type switches back to 0)
   ENDIF

   IF [Z LE #4]
      G1 Z[#5] F[#7]
      o<YDownfeed> call
   ELSE
      #9 = [Z + #6]
      IF [#9 LT #4]
         G1 Z[#5] F[#7]
      ELSE
         G1 Z[#9] F[#7]
      ENDIF

      IF [Z LE #5]
         o<Disable_At_Z_Limit> call
   ENDIF
ELSE
   IF [#<_hal[grinder.enable_x]> EQ 0]
   G04 P0.5 (Just so the interpreter isn't spinning, because both X and Z are off)
ENDIF

O<ZMove_RepeatTZpe2> endsub
